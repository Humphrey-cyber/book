{% extends 'partials/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Book Image Section -->
        <div class="col-md-6">
            <img src="{{ book.cover_image.url }}" class="img-fluid rounded" alt="{{ book.title }}" style="width: 100%; max-height: 600px; object-fit: cover;">
        </div>

        <!-- Book Details Section -->
        <div class="col-md-6">
            <h2 class="mb-3" style="font-size: 2rem; color: #333;">{{ book.title }}</h2>
            <h3 class="text-muted" style="font-size: 1.5rem;">${{ book.price }}</h3>

            <div class="my-4">
                <button class="btn btn-success btn-lg mb-2" style="width: 100%; font-size: 1rem;" onclick="addToCart('{{ book.id }}', '{{ book.title }}', '{{ book.cover_image.url }}', {{ book.price }})">Add to Cart</button>
                <button class="btn btn-outline-secondary btn-lg" style="width: 100%; font-size: 1rem;">Buy Now</button>
            </div>

            <p class="mt-4" style="color: #666; font-size: 1rem; line-height: 1.6;">
                {{ book.description }}
            </p>

            <p class="text-muted" style="font-size: 0.85rem;">
                You will get a PDF ({{ book.file_size }}) file
            </p>

            <!-- Social Share Links -->
            <div class="mt-3">
                <span>Share:</span>
                {% if book.facebook_link %}
                    <a href="{{ book.facebook_link }}" target="_blank" class="mx-2 text-dark" style="font-size: 1.2rem;">
                        <i class="fab fa-facebook"></i>
                    </a>
                {% endif %}
                {% if book.twitter_link %}
                    <a href="{{ book.twitter_link }}" target="_blank" class="mx-2 text-dark" style="font-size: 1.2rem;">
                        <i class="fab fa-twitter"></i>
                    </a>
                {% endif %}
                {% if book.instagram_link %}
                    <a href="{{ book.instagram_link }}" target="_blank" class="mx-2 text-dark" style="font-size: 1.2rem;">
                        <i class="fab fa-instagram"></i>
                    </a>
                {% endif %}
                {% if book.whatsapp_link %}
                    <a href="{{ book.whatsapp_link }}" target="_blank" class="mx-2 text-dark" style="font-size: 1.2rem;">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                {% endif %}
                {% if book.youtube_link %}
                    <a href="{{ book.youtube_link }}" target="_blank" class="mx-2 text-dark" style="font-size: 1.2rem;">
                        <i class="fab fa-youtube"></i>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Cart Panel -->
<div class="cart-panel" id="cartPanel" style="position: fixed; top: 0; right: -400px; width: 400px; height: 100%; background-color: #fff; box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5); transition: right 0.4s ease; padding: 20px; overflow-y: auto; z-index: 1000;">
    <button class="close-cart" onclick="toggleCart()" style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 1.5rem; cursor: pointer; color: #333;">Ã—</button>
    <h2 style="font-size: 1.5rem; text-align: center; padding-bottom: 1rem; border-bottom: 1px solid #eee;">Your Cart</h2>

    <div id="cartItems" style="margin-top: 20px;">
        <!-- Cart items will be dynamically added here -->
    </div>

    <div class="cart-total" style="text-align: center; font-size: 1.2rem; font-weight: bold; margin: 20px 0;">
        Total: $<span id="cartTotal">0.00</span>
    </div>
    <button class="checkout-btn" style="width: 100%; background-color: #28a745; color: #fff; border: none; padding: 10px; font-size: 1rem; cursor: pointer; border-radius: 5px;" onclick="proceedToCheckout()">Proceed to Checkout</button>
</div>

<script>
    let cart = [];
    let total = 0;

    // Initialize cart from localStorage
    function initializeCart() {
        const storedCart = localStorage.getItem('cart');
        if (storedCart) {
            cart = JSON.parse(storedCart);
            total = cart.reduce((sum, item) => sum + item.price, 0);
            updateCartDisplay();
        }
    }

    // Function to toggle cart panel visibility
    function toggleCart() {
        const cartPanel = document.getElementById('cartPanel');
        cartPanel.style.right = cartPanel.style.right === '0px' ? '-400px' : '0px';
    }

    // Function to add item to cart and update item count
    function addToCart(id, title, image, price) {
        const item = {
            id: id,
            title: title,
            image: image,
            price: price
        };
        cart.push(item); // Add new instance to the cart array
        total += price; // Update total

        // Save cart to localStorage
        localStorage.setItem('cart', JSON.stringify(cart));

        updateCartDisplay();

        // Show a notification for adding to the cart
        alert(`${title} added to the cart!`);

        // Update item count in cart icon
        const itemCountElement = document.getElementById("itemCount");
        itemCountElement.textContent = cart.length;
        itemCountElement.style.display = 'block';
    }

    // Function to update the cart display
    function updateCartDisplay() {
        const cartItemsContainer = document.getElementById("cartItems");
        const cartTotalElement = document.getElementById("cartTotal");

        cartItemsContainer.innerHTML = ''; // Clear previous display

        // Iterate over each item in the cart array and display as a separate row
        cart.forEach((item, index) => {
            const cartItem = document.createElement("div");
            cartItem.classList.add("cart-item");
            cartItem.style.display = "flex";
            cartItem.style.alignItems = "center";
            cartItem.style.marginBottom = "15px";
            cartItem.style.paddingBottom = "15px";
            cartItem.style.borderBottom = "1px solid #eee";
            
            cartItem.innerHTML = `
                <img src="${item.image}" alt="${item.title}" style="width: 80px; height: 80px; object-fit: cover; margin-right: 10px; border-radius: 5px;">
                <div style="flex-grow: 1;">
                    <h4 style="margin: 0;">${item.title}</h4>
                    <div style="font-size: 0.9rem; color: #666;">Price: $${item.price}</div>
                    <a href="javascript:void(0);" class="remove-link" style="color: #d9534f; font-size: 0.85rem; text-decoration: none;" onclick="removeFromCart(${index})">Remove</a>
                </div>
            `;
            
            cartItemsContainer.appendChild(cartItem);
        });

        // Update cart total
        cartTotalElement.textContent = total.toFixed(2);

        // Update item count in cart icon
        const itemCountElement = document.getElementById("itemCount");
        itemCountElement.textContent = cart.length;
        if (cart.length > 0) {
            itemCountElement.style.display = 'block';
        } else {
            itemCountElement.style.display = 'none';
        }
    }

    // Function to remove an item from the cart by index
    function removeFromCart(index) {
        const item = cart[index];
        total -= item.price; // Deduct the price from total
        cart.splice(index, 1); // Remove item from cart array

        // Save updated cart to localStorage
        localStorage.setItem('cart', JSON.stringify(cart));

        updateCartDisplay();
    }

    // Placeholder function for checkout button
    function proceedToCheckout() {
        alert('Proceeding to checkout...');
    }

    // Initialize cart when the page loads
    window.onload = initializeCart;
</script>
{% endblock %}
